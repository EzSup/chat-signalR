@page "/"
@inject ISnackbar snackbarService;
@inject IJSRuntime js;

<form @onsubmit="Connect" class="container">
    <h4>Joining the chat form</h4>
    <input @bind="_chatName" placeholder="Enter chat name" @onkeypress="OnKeyPress" disabled="@(!hubService.IsConnected())" />
    <input @bind="_userName" placeholder="Enter your name" @onkeypress="OnKeyPress" disabled="@(!hubService.IsConnected())" />

    @if(hubService.IsConnecting())
    {
        <div>
            <MudProgressCircular Style="position: fixed; top: 5px; left: 5px;" Color="Color.Info" Size="Size.Large" Indeterminate="true" />
        </div>
        
    }

    <button type="submit" disabled="@(!hubService.IsConnected())">Join chat</button>
</form>

<script>
    function alertConnected(){
        alert("connected!");
    }
</script>

@code {
    private string? _chatName;
    private string? _userName;

    protected override async Task OnInitializedAsync()
    {
        hubService.OnConnected += () => snackbarService.Add("Connected to the server.", Severity.Info);
        await hubService.Сonnect();
        await base.OnInitializedAsync();        
    }

    private void OnKeyPress(KeyboardEventArgs e)
    {
        if (e.Code == "Enter")
        {
            Connect();
        }
    }

    private void Connect()
    {
        if (!string.IsNullOrWhiteSpace(_chatName) && !string.IsNullOrWhiteSpace(_userName) && hubService.IsConnected())
        {   
            navigationManager.NavigateTo($"/chat_chat={_chatName}&user={_userName}");
        }
    }
}
